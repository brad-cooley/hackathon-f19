{"ast":null,"code":"import _slicedToArray from \"/Users/jack/Desktop/deploy/hackathon-f19/front/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/jack/Desktop/deploy/hackathon-f19/front/src/Components/Main.js\";\nimport React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Container, Typography, CircularProgress } from \"@material-ui/core\";\nimport CardGrid from \"./CardGrid\";\nimport * as firebase from \"firebase\";\n\nrequire('firebase/auth');\n\nvar user_uid = undefined;\nlet firebaseAppDefined = false;\nsetInterval(() => {\n  if (!firebaseAppDefined) {\n    if (firebase.app()) {\n      firebaseAppDefined = true;\n      firebase.auth().signInAnonymously().catch(error => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n      });\n      firebase.auth().onAuthStateChanged(user => {\n        if (user) user_uid = user.uid;\n      });\n    }\n  }\n}, 100);\nconst useStyles = makeStyles(theme => ({\n  heroContent: {\n    padding: theme.spacing(1, 0, 2),\n    maxWidth: \"100%\"\n  },\n  load: {\n    align: \"center\",\n    paddingTop: 5\n  }\n})); // Your web app's Firebase configuration\n\nvar firebaseConfig = {\n  apiKey: \"AIzaSyDkr4-pv5Hf84JmJiOaNl9T9vqDR-D6fNQ\",\n  authDomain: \"devfest-24557.firebaseapp.com\",\n\n  /* databaseURL: \"https://devfest-24557.firebaseio.com\", */\n  projectId: \"devfest-24557\",\n\n  /*storageBucket: \"devfest-24557.appspot.com\",\n  messagingSenderId: \"205291993209\",*/\n  appId: \"1:205291993209:web:00bcf099bae983c9953ca8\",\n  measurementId: \"G-2V3TFV6VNX\"\n}; // Initialize Firebase\n\nfirebase.initializeApp(firebaseConfig);\nfirebase.analytics();\nvar db = firebase.firestore();\n\nfunction distance(lat1, lon1, lat2, lon2) {\n  if (lat1 === lat2 && lon1 === lon2) {\n    return 0;\n  } else {\n    var radlat1 = Math.PI * lat1 / 180;\n    var radlat2 = Math.PI * lat2 / 180;\n    var theta = lon1 - lon2;\n    var radtheta = Math.PI * theta / 180;\n    var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\n    if (dist > 1) {\n      dist = 1;\n    }\n\n    dist = Math.acos(dist);\n    dist = dist * 180 / Math.PI;\n    dist = dist * 60 * 1.1515;\n    dist = dist * 0.99999969062;\n    return dist;\n  }\n}\n\nnavigator.geolocation.getCurrentPosition(position => {\n  startupQuery(position.coords.latitude, position.coords.longitude);\n});\n\nfunction startupQuery(lat = 0, lon = 0) {\n  // eslint-disable-next-line no-undef\n  var startTime = moment().subtract(12, \"hours\").toDate();\n  console.log(\"Places with 15 miles of you\");\n  let data = [];\n  db.collection(\"venues\").get().then(venues => {\n    venues.forEach(venue => {\n      var ven_loc = venue.data().location;\n      var miles = distance(ven_loc.latitude, ven_loc.longitude, lat, lon);\n\n      if (miles < 15) {\n        var newVenueObj = {\n          venue: venue.data(),\n          checkins: []\n        };\n        newVenueObj.venue.id = venue.id;\n        db.collection(\"venues/\".concat(venue.id, \"/checkins\")).where(\"timestamp\", \">\", startTime).get().then(checkins => {\n          checkins.forEach(checkin => {\n            newVenueObj.checkins.push(checkin.data());\n          });\n        });\n      }\n\n      data.push(newVenueObj);\n      console.log(newVenueObj);\n    });\n  });\n}\n\nexport function sendCheckIn(venue_id) {\n  db.collection(\"venues\").doc(venue_id).collection(\"checkins\").add({\n    uid: user_uid,\n    timestamp: firebase.firestore.FieldValue.serverTimestamp()\n  }).then(() => {\n    console.log(\"Check-in Successful!\");\n  });\n}\nexport default function Main() {\n  const classes = useStyles();\n\n  const _React$useState = React.useState(null),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        data = _React$useState2[0],\n        setData = _React$useState2[1];\n\n  const _React$useState3 = React.useState(true),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        isLoading = _React$useState4[0],\n        setIsLoading = _React$useState4[1];\n\n  React.useEffect(() => {\n    let lat = 0,\n        lon = 0;\n    navigator.geolocation.getCurrentPosition(position => {\n      lat = position.coords.latitude ? position.coords.latitude : 0;\n      lon = position.coords.longitude ? position.coords.longitude : 0;\n    }); // eslint-disable-next-line no-undef\n\n    var startTime = moment().subtract(12, \"hours\").toDate();\n    db.collection(\"venues\").get().then(venues => {\n      let temp = [];\n      venues.forEach(venue => {\n        var ven_loc = venue.data().location;\n        var miles = distance(ven_loc.latitude, ven_loc.longitude, lat, lon);\n\n        if (miles < 15) {\n          var newVenueObj = {\n            venue: venue.data(),\n            checkins: []\n          };\n          newVenueObj.venue.id = venue.id;\n          db.collection(\"venues/\".concat(venue.id, \"/checkins\")).where(\"timestamp\", \">\", startTime).get().then(checkins => {\n            checkins.forEach(checkin => {\n              newVenueObj.checkins.push(checkin.data());\n            });\n          });\n          temp.push(newVenueObj);\n          console.log(newVenueObj);\n        }\n      });\n      setData(temp);\n      setIsLoading(false);\n    });\n  }, []);\n  return !isLoading ? React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, console.log(data), React.createElement(\"div\", {\n    className: classes.heroContent,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, React.createElement(Container, {\n    maxWidth: \"sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, React.createElement(Typography, {\n    component: \"h5\",\n    variant: \"h6\",\n    align: \"center\",\n    color: \"textPrimary\",\n    gutterBottom: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, \"Welcome to Hot List!\"), React.createElement(Typography, {\n    variant: \"body1\",\n    align: \"center\",\n    color: \"textSecondary\",\n    paragraph: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"This should be a blurb that says something like \\\"Looking for something quiet or something loud? We've got it below. Don't forget to check in!\\\" but sounds better.\"))), console.log(data), React.createElement(CardGrid, {\n    data: data.filter(value => Object.keys(value).length !== 0).sort((a, b) => a.checkins.length < b.checkins.length ? 1 : -1)\n    /*data.sort((a, b) =>\n      a.checkInsToday < b.checkInsToday\n        ? 1\n        : a.checkInsToday === b.checkInsToday\n        ? a.checkInsThisWeek < b.checkInsThisWeek\n          ? 1\n          : -1\n        : -1\n    )*/\n    ,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  })) : React.createElement(CircularProgress, {\n    className: classes.load,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  });\n}","map":{"version":3,"sources":["/Users/jack/Desktop/deploy/hackathon-f19/front/src/Components/Main.js"],"names":["React","makeStyles","Container","Typography","CircularProgress","CardGrid","firebase","require","user_uid","undefined","firebaseAppDefined","setInterval","app","auth","signInAnonymously","catch","error","errorCode","code","errorMessage","message","onAuthStateChanged","user","uid","useStyles","theme","heroContent","padding","spacing","maxWidth","load","align","paddingTop","firebaseConfig","apiKey","authDomain","projectId","appId","measurementId","initializeApp","analytics","db","firestore","distance","lat1","lon1","lat2","lon2","radlat1","Math","PI","radlat2","theta","radtheta","dist","sin","cos","acos","navigator","geolocation","getCurrentPosition","position","startupQuery","coords","latitude","longitude","lat","lon","startTime","moment","subtract","toDate","console","log","data","collection","get","then","venues","forEach","venue","ven_loc","location","miles","newVenueObj","checkins","id","where","checkin","push","sendCheckIn","venue_id","doc","add","timestamp","FieldValue","serverTimestamp","Main","classes","useState","setData","isLoading","setIsLoading","useEffect","temp","filter","value","Object","keys","length","sort","a","b"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAA2B,0BAA3B;AACA,SAASC,SAAT,EAAoBC,UAApB,EAAgCC,gBAAhC,QAAwD,mBAAxD;AACA,OAAOC,QAAP,MAAqB,YAArB;AACA,OAAO,KAAKC,QAAZ,MAA0B,UAA1B;;AACAC,OAAO,CAAC,eAAD,CAAP;;AAEA,IAAIC,QAAQ,GAAGC,SAAf;AACA,IAAIC,kBAAkB,GAAG,KAAzB;AAEAC,WAAW,CAAC,MAAM;AAChB,MAAI,CAACD,kBAAL,EAAyB;AACvB,QAAIJ,QAAQ,CAACM,GAAT,EAAJ,EAAoB;AAClBF,MAAAA,kBAAkB,GAAG,IAArB;AAEAJ,MAAAA,QAAQ,CAACO,IAAT,GAAgBC,iBAAhB,GAAoCC,KAApC,CAA2CC,KAAD,IAAW;AACnD,YAAIC,SAAS,GAAGD,KAAK,CAACE,IAAtB;AACA,YAAIC,YAAY,GAAGH,KAAK,CAACI,OAAzB;AACD,OAHD;AAKAd,MAAAA,QAAQ,CAACO,IAAT,GAAgBQ,kBAAhB,CAAoCC,IAAD,IAAU;AAC3C,YAAGA,IAAH,EACEd,QAAQ,GAAGc,IAAI,CAACC,GAAhB;AACH,OAHD;AAID;AACF;AACF,CAhBU,EAgBR,GAhBQ,CAAX;AAkBA,MAAMC,SAAS,GAAGvB,UAAU,CAACwB,KAAK,KAAK;AACrCC,EAAAA,WAAW,EAAE;AACXC,IAAAA,OAAO,EAAEF,KAAK,CAACG,OAAN,CAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,CADE;AAEXC,IAAAA,QAAQ,EAAE;AAFC,GADwB;AAKrCC,EAAAA,IAAI,EAAE;AACJC,IAAAA,KAAK,EAAE,QADH;AAEJC,IAAAA,UAAU,EAAE;AAFR;AAL+B,CAAL,CAAN,CAA5B,C,CAWA;;AACA,IAAIC,cAAc,GAAG;AACnBC,EAAAA,MAAM,EAAE,yCADW;AAEnBC,EAAAA,UAAU,EAAE,+BAFO;;AAGnB;AACAC,EAAAA,SAAS,EAAE,eAJQ;;AAKnB;;AAEAC,EAAAA,KAAK,EAAE,2CAPY;AAQnBC,EAAAA,aAAa,EAAE;AARI,CAArB,C,CAUA;;AACAhC,QAAQ,CAACiC,aAAT,CAAuBN,cAAvB;AACA3B,QAAQ,CAACkC,SAAT;AAEA,IAAIC,EAAE,GAAGnC,QAAQ,CAACoC,SAAT,EAAT;;AAEA,SAASC,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,IAA9B,EAAoCC,IAApC,EAA0C;AACxC,MAAIH,IAAI,KAAKE,IAAT,IAAiBD,IAAI,KAAKE,IAA9B,EAAoC;AAClC,WAAO,CAAP;AACD,GAFD,MAEO;AACL,QAAIC,OAAO,GAAIC,IAAI,CAACC,EAAL,GAAUN,IAAX,GAAmB,GAAjC;AACA,QAAIO,OAAO,GAAIF,IAAI,CAACC,EAAL,GAAUJ,IAAX,GAAmB,GAAjC;AACA,QAAIM,KAAK,GAAGP,IAAI,GAAGE,IAAnB;AACA,QAAIM,QAAQ,GAAIJ,IAAI,CAACC,EAAL,GAAUE,KAAX,GAAoB,GAAnC;AACA,QAAIE,IAAI,GACNL,IAAI,CAACM,GAAL,CAASP,OAAT,IAAoBC,IAAI,CAACM,GAAL,CAASJ,OAAT,CAApB,GACAF,IAAI,CAACO,GAAL,CAASR,OAAT,IAAoBC,IAAI,CAACO,GAAL,CAASL,OAAT,CAApB,GAAwCF,IAAI,CAACO,GAAL,CAASH,QAAT,CAF1C;;AAGA,QAAIC,IAAI,GAAG,CAAX,EAAc;AACZA,MAAAA,IAAI,GAAG,CAAP;AACD;;AACDA,IAAAA,IAAI,GAAGL,IAAI,CAACQ,IAAL,CAAUH,IAAV,CAAP;AACAA,IAAAA,IAAI,GAAIA,IAAI,GAAG,GAAR,GAAeL,IAAI,CAACC,EAA3B;AACAI,IAAAA,IAAI,GAAGA,IAAI,GAAG,EAAP,GAAY,MAAnB;AACAA,IAAAA,IAAI,GAAGA,IAAI,GAAG,aAAd;AACA,WAAOA,IAAP;AACD;AACF;;AAEDI,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyCC,QAAQ,IAAI;AACnDC,EAAAA,YAAY,CAACD,QAAQ,CAACE,MAAT,CAAgBC,QAAjB,EAA2BH,QAAQ,CAACE,MAAT,CAAgBE,SAA3C,CAAZ;AACD,CAFD;;AAIA,SAASH,YAAT,CAAsBI,GAAG,GAAG,CAA5B,EAA+BC,GAAG,GAAG,CAArC,EAAwC;AACtC;AACA,MAAIC,SAAS,GAAGC,MAAM,GACnBC,QADa,CACJ,EADI,EACA,OADA,EAEbC,MAFa,EAAhB;AAIAC,EAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACA,MAAIC,IAAI,GAAG,EAAX;AAEAjC,EAAAA,EAAE,CAACkC,UAAH,CAAc,QAAd,EACGC,GADH,GAEGC,IAFH,CAEQC,MAAM,IAAI;AACdA,IAAAA,MAAM,CAACC,OAAP,CAAeC,KAAK,IAAI;AACtB,UAAIC,OAAO,GAAGD,KAAK,CAACN,IAAN,GAAaQ,QAA3B;AACA,UAAIC,KAAK,GAAGxC,QAAQ,CAACsC,OAAO,CAACjB,QAAT,EAAmBiB,OAAO,CAAChB,SAA3B,EAAsCC,GAAtC,EAA2CC,GAA3C,CAApB;;AAEA,UAAIgB,KAAK,GAAG,EAAZ,EAAgB;AACd,YAAIC,WAAW,GAAG;AAAEJ,UAAAA,KAAK,EAAEA,KAAK,CAACN,IAAN,EAAT;AAAuBW,UAAAA,QAAQ,EAAE;AAAjC,SAAlB;AACAD,QAAAA,WAAW,CAACJ,KAAZ,CAAkBM,EAAlB,GAAuBN,KAAK,CAACM,EAA7B;AACA7C,QAAAA,EAAE,CAACkC,UAAH,kBAAwBK,KAAK,CAACM,EAA9B,gBACGC,KADH,CACS,WADT,EACsB,GADtB,EAC2BnB,SAD3B,EAEGQ,GAFH,GAGGC,IAHH,CAGQQ,QAAQ,IAAI;AAChBA,UAAAA,QAAQ,CAACN,OAAT,CAAiBS,OAAO,IAAI;AAC1BJ,YAAAA,WAAW,CAACC,QAAZ,CAAqBI,IAArB,CAA0BD,OAAO,CAACd,IAAR,EAA1B;AACD,WAFD;AAGD,SAPH;AAQD;;AACDA,MAAAA,IAAI,CAACe,IAAL,CAAUL,WAAV;AAEAZ,MAAAA,OAAO,CAACC,GAAR,CAAYW,WAAZ;AACD,KAnBD;AAoBD,GAvBH;AAwBD;;AAED,OAAO,SAASM,WAAT,CAAqBC,QAArB,EAA+B;AACpClD,EAAAA,EAAE,CAACkC,UAAH,CAAc,QAAd,EACGiB,GADH,CACOD,QADP,EAEGhB,UAFH,CAEc,UAFd,EAGGkB,GAHH,CAGO;AACHtE,IAAAA,GAAG,EAAEf,QADF;AAEHsF,IAAAA,SAAS,EAAExF,QAAQ,CAACoC,SAAT,CAAmBqD,UAAnB,CAA8BC,eAA9B;AAFR,GAHP,EAOGnB,IAPH,CAOQ,MAAM;AACVL,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACD,GATH;AAUD;AAED,eAAe,SAASwB,IAAT,GAAgB;AAC7B,QAAMC,OAAO,GAAG1E,SAAS,EAAzB;;AAD6B,0BAELxB,KAAK,CAACmG,QAAN,CAAe,IAAf,CAFK;AAAA;AAAA,QAEtBzB,IAFsB;AAAA,QAEhB0B,OAFgB;;AAAA,2BAGKpG,KAAK,CAACmG,QAAN,CAAe,IAAf,CAHL;AAAA;AAAA,QAGtBE,SAHsB;AAAA,QAGXC,YAHW;;AAK7BtG,EAAAA,KAAK,CAACuG,SAAN,CAAgB,MAAM;AACpB,QAAIrC,GAAG,GAAG,CAAV;AAAA,QACEC,GAAG,GAAG,CADR;AAEAT,IAAAA,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CAAyCC,QAAQ,IAAI;AACnDK,MAAAA,GAAG,GAAGL,QAAQ,CAACE,MAAT,CAAgBC,QAAhB,GAA2BH,QAAQ,CAACE,MAAT,CAAgBC,QAA3C,GAAsD,CAA5D;AACAG,MAAAA,GAAG,GAAGN,QAAQ,CAACE,MAAT,CAAgBE,SAAhB,GAA4BJ,QAAQ,CAACE,MAAT,CAAgBE,SAA5C,GAAwD,CAA9D;AACD,KAHD,EAHoB,CAQpB;;AACA,QAAIG,SAAS,GAAGC,MAAM,GACnBC,QADa,CACJ,EADI,EACA,OADA,EAEbC,MAFa,EAAhB;AAGA9B,IAAAA,EAAE,CAACkC,UAAH,CAAc,QAAd,EACGC,GADH,GAEGC,IAFH,CAEQC,MAAM,IAAI;AACd,UAAI0B,IAAI,GAAG,EAAX;AACA1B,MAAAA,MAAM,CAACC,OAAP,CAAeC,KAAK,IAAI;AACtB,YAAIC,OAAO,GAAGD,KAAK,CAACN,IAAN,GAAaQ,QAA3B;AACA,YAAIC,KAAK,GAAGxC,QAAQ,CAACsC,OAAO,CAACjB,QAAT,EAAmBiB,OAAO,CAAChB,SAA3B,EAAsCC,GAAtC,EAA2CC,GAA3C,CAApB;;AAEA,YAAIgB,KAAK,GAAG,EAAZ,EAAgB;AACd,cAAIC,WAAW,GAAG;AAAEJ,YAAAA,KAAK,EAAEA,KAAK,CAACN,IAAN,EAAT;AAAuBW,YAAAA,QAAQ,EAAE;AAAjC,WAAlB;AACAD,UAAAA,WAAW,CAACJ,KAAZ,CAAkBM,EAAlB,GAAuBN,KAAK,CAACM,EAA7B;AACA7C,UAAAA,EAAE,CAACkC,UAAH,kBAAwBK,KAAK,CAACM,EAA9B,gBACGC,KADH,CACS,WADT,EACsB,GADtB,EAC2BnB,SAD3B,EAEGQ,GAFH,GAGGC,IAHH,CAGQQ,QAAQ,IAAI;AAChBA,YAAAA,QAAQ,CAACN,OAAT,CAAiBS,OAAO,IAAI;AAC1BJ,cAAAA,WAAW,CAACC,QAAZ,CAAqBI,IAArB,CAA0BD,OAAO,CAACd,IAAR,EAA1B;AACD,aAFD;AAGD,WAPH;AAQA8B,UAAAA,IAAI,CAACf,IAAL,CAAUL,WAAV;AAEAZ,UAAAA,OAAO,CAACC,GAAR,CAAYW,WAAZ;AACD;AACF,OAnBD;AAoBAgB,MAAAA,OAAO,CAACI,IAAD,CAAP;AACAF,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACD,KA1BH;AA2BD,GAvCD,EAuCG,EAvCH;AAyCA,SAAO,CAACD,SAAD,GACL,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG7B,OAAO,CAACC,GAAR,CAAYC,IAAZ,CADH,EAEE;AAAK,IAAA,SAAS,EAAEwB,OAAO,CAACxE,WAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,SAAD;AAAW,IAAA,QAAQ,EAAC,IAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,UAAD;AACE,IAAA,SAAS,EAAC,IADZ;AAEE,IAAA,OAAO,EAAC,IAFV;AAGE,IAAA,KAAK,EAAC,QAHR;AAIE,IAAA,KAAK,EAAC,aAJR;AAKE,IAAA,YAAY,MALd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BADF,EAUE,oBAAC,UAAD;AACE,IAAA,OAAO,EAAC,OADV;AAEE,IAAA,KAAK,EAAC,QAFR;AAGE,IAAA,KAAK,EAAC,eAHR;AAIE,IAAA,SAAS,MAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2KAVF,CADF,CAFF,EAyBG8C,OAAO,CAACC,GAAR,CAAYC,IAAZ,CAzBH,EA0BE,oBAAC,QAAD;AACE,IAAA,IAAI,EAAEA,IAAI,CACP+B,MADG,CACIC,KAAK,IAAIC,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBG,MAAnB,KAA8B,CAD3C,EAEHC,IAFG,CAEE,CAACC,CAAD,EAAIC,CAAJ,KAAWD,CAAC,CAAC1B,QAAF,CAAWwB,MAAX,GAAoBG,CAAC,CAAC3B,QAAF,CAAWwB,MAA/B,GAAwC,CAAxC,GAA4C,CAAC,CAF1D;AAGN;;;;;;;;;AAJF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA1BF,CADK,GA2CL,oBAAC,gBAAD;AAAkB,IAAA,SAAS,EAAEX,OAAO,CAACpE,IAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA3CF;AA6CD","sourcesContent":["import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Container, Typography, CircularProgress } from \"@material-ui/core\";\nimport CardGrid from \"./CardGrid\";\nimport * as firebase from \"firebase\";\nrequire('firebase/auth')\n\nvar user_uid = undefined;\nlet firebaseAppDefined = false\n\nsetInterval(() => {\n  if (!firebaseAppDefined) {\n    if (firebase.app()) {\n      firebaseAppDefined = true\n\n      firebase.auth().signInAnonymously().catch((error) => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n      })\n      \n      firebase.auth().onAuthStateChanged((user) => {\n        if(user) \n          user_uid = user.uid\n      })\n    }\n  }\n}, 100)\n\nconst useStyles = makeStyles(theme => ({\n  heroContent: {\n    padding: theme.spacing(1, 0, 2),\n    maxWidth: \"100%\"\n  },\n  load: {\n    align: \"center\",\n    paddingTop: 5\n  }\n}));\n\n// Your web app's Firebase configuration\nvar firebaseConfig = {\n  apiKey: \"AIzaSyDkr4-pv5Hf84JmJiOaNl9T9vqDR-D6fNQ\",\n  authDomain: \"devfest-24557.firebaseapp.com\",\n  /* databaseURL: \"https://devfest-24557.firebaseio.com\", */\n  projectId: \"devfest-24557\",\n  /*storageBucket: \"devfest-24557.appspot.com\",\n  messagingSenderId: \"205291993209\",*/\n  appId: \"1:205291993209:web:00bcf099bae983c9953ca8\",\n  measurementId: \"G-2V3TFV6VNX\"\n};\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\nfirebase.analytics();\n\nvar db = firebase.firestore();\n\nfunction distance(lat1, lon1, lat2, lon2) {\n  if (lat1 === lat2 && lon1 === lon2) {\n    return 0;\n  } else {\n    var radlat1 = (Math.PI * lat1) / 180;\n    var radlat2 = (Math.PI * lat2) / 180;\n    var theta = lon1 - lon2;\n    var radtheta = (Math.PI * theta) / 180;\n    var dist =\n      Math.sin(radlat1) * Math.sin(radlat2) +\n      Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n    if (dist > 1) {\n      dist = 1;\n    }\n    dist = Math.acos(dist);\n    dist = (dist * 180) / Math.PI;\n    dist = dist * 60 * 1.1515;\n    dist = dist * 0.99999969062;\n    return dist;\n  }\n}\n\nnavigator.geolocation.getCurrentPosition(position => {\n  startupQuery(position.coords.latitude, position.coords.longitude);\n});\n\nfunction startupQuery(lat = 0, lon = 0) {\n  // eslint-disable-next-line no-undef\n  var startTime = moment()\n    .subtract(12, \"hours\")\n    .toDate();\n\n  console.log(\"Places with 15 miles of you\");\n  let data = [];\n\n  db.collection(\"venues\")\n    .get()\n    .then(venues => {\n      venues.forEach(venue => {\n        var ven_loc = venue.data().location;\n        var miles = distance(ven_loc.latitude, ven_loc.longitude, lat, lon);\n\n        if (miles < 15) {\n          var newVenueObj = { venue: venue.data(), checkins: [] };\n          newVenueObj.venue.id = venue.id;\n          db.collection(`venues/${venue.id}/checkins`)\n            .where(\"timestamp\", \">\", startTime)\n            .get()\n            .then(checkins => {\n              checkins.forEach(checkin => {\n                newVenueObj.checkins.push(checkin.data());\n              });\n            });\n        }\n        data.push(newVenueObj);\n\n        console.log(newVenueObj);\n      });\n    });\n}\n\nexport function sendCheckIn(venue_id) {\n  db.collection(\"venues\")\n    .doc(venue_id)\n    .collection(\"checkins\")\n    .add({\n      uid: user_uid,\n      timestamp: firebase.firestore.FieldValue.serverTimestamp()\n    })\n    .then(() => {\n      console.log(\"Check-in Successful!\");\n    });\n}\n\nexport default function Main() {\n  const classes = useStyles();\n  const [data, setData] = React.useState(null);\n  const [isLoading, setIsLoading] = React.useState(true);\n\n  React.useEffect(() => {\n    let lat = 0,\n      lon = 0;\n    navigator.geolocation.getCurrentPosition(position => {\n      lat = position.coords.latitude ? position.coords.latitude : 0;\n      lon = position.coords.longitude ? position.coords.longitude : 0;\n    });\n\n    // eslint-disable-next-line no-undef\n    var startTime = moment()\n      .subtract(12, \"hours\")\n      .toDate();\n    db.collection(\"venues\")\n      .get()\n      .then(venues => {\n        let temp = [];\n        venues.forEach(venue => {\n          var ven_loc = venue.data().location;\n          var miles = distance(ven_loc.latitude, ven_loc.longitude, lat, lon);\n\n          if (miles < 15) {\n            var newVenueObj = { venue: venue.data(), checkins: [] };\n            newVenueObj.venue.id = venue.id;\n            db.collection(`venues/${venue.id}/checkins`)\n              .where(\"timestamp\", \">\", startTime)\n              .get()\n              .then(checkins => {\n                checkins.forEach(checkin => {\n                  newVenueObj.checkins.push(checkin.data());\n                });\n              });\n            temp.push(newVenueObj);\n\n            console.log(newVenueObj);\n          }\n        });\n        setData(temp);\n        setIsLoading(false);\n      });\n  }, []);\n\n  return !isLoading ? (\n    <React.Fragment>\n      {console.log(data)}\n      <div className={classes.heroContent}>\n        <Container maxWidth=\"sm\">\n          <Typography\n            component=\"h5\"\n            variant=\"h6\"\n            align=\"center\"\n            color=\"textPrimary\"\n            gutterBottom\n          >\n            Welcome to Hot List!\n          </Typography>\n          <Typography\n            variant=\"body1\"\n            align=\"center\"\n            color=\"textSecondary\"\n            paragraph\n          >\n            This should be a blurb that says something like \"Looking for\n            something quiet or something loud? We've got it below. Don't forget\n            to check in!\" but sounds better.\n          </Typography>\n        </Container>\n      </div>\n      {console.log(data)}\n      <CardGrid\n        data={data\n          .filter(value => Object.keys(value).length !== 0)\n          .sort((a, b) => (a.checkins.length < b.checkins.length ? 1 : -1))}\n        /*data.sort((a, b) =>\n          a.checkInsToday < b.checkInsToday\n            ? 1\n            : a.checkInsToday === b.checkInsToday\n            ? a.checkInsThisWeek < b.checkInsThisWeek\n              ? 1\n              : -1\n            : -1\n        )*/\n      />\n    </React.Fragment>\n  ) : (\n    <CircularProgress className={classes.load} />\n  );\n}\n"]},"metadata":{},"sourceType":"module"}